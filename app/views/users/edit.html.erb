<div class="profile-container">
  <h1>Meu Perfil</h1>

  <div class="profile-card">

    <%= form_with model: @user, url: profile_path, method: :patch, multipart: true, data: { turbo: false } do |f| %>

      <!-- Avatar (com fallback) -->
      <div class="profile-avatar-box">
        <%= image_tag @user.avatar_or_default, id: "avatar-preview" %>
      </div>

      <label class="avatar-button">
        Alterar foto
        <%= f.file_field :avatar, class: "hidden", onchange: "previewImage(event)" %>
      </label>

      <!-- Grid de campos -->
      <div class="profile-grid">

        <div class="profile-field">
          <%= f.label :username, "Nome de Usuário" %>
          <%= f.text_field :username, class: "profile-input" %>
        </div>

        <div class="profile-field">
          <%= f.label :birthdate, "Data de Nascimento" %>
          <%= f.date_field :birthdate, class: "profile-input" %>
        </div>

        <div class="profile-field">
          <%= f.label :gender, "Gênero" %>
          <%= f.select :gender,
              [["Homem","homem"],["Mulher","mulher"],
              ["Outro","outro"]],
              {},
              class: "profile-select" %>
        </div>

        <div class="profile-field">
          <%= f.label :interested_in, "Interessado em conhecer" %>
          <%= f.select :interested_in,
              [["Homem","homem"],["Mulher","mulher"],["Outro","outro"]],
               {},
               class: "profile-select" %>
        </div>

        <div class="profile-field" style="grid-column: 1 / -1;">
          <%= f.label :bio, "Biografia" %>
          <%= f.text_area :bio, rows: 3, class: "profile-textarea" %>
        </div>

          <!-- NOVO: Campo de Upload para o Álbum de Fotos -->
        <div class="profile-field" style="grid-column: 1 / -1; margin-top: 20px;">
          <%= f.label :album_photos, "Adicionar Fotos ao Álbum" %>
          <%= f.file_field :album_photos, multiple: true, accept: "image/*", class: "profile-input" %>
          <p class="text-sm text-gray-500 mt-1">Você pode selecionar várias fotos de uma vez.</p>
        </div>


        <!-- HOBBIES -->
        <div class="hobbies-box">
          <%= f.label :hobbies_list, "Hobbys" %>

          <div class="hobbies-list">
            <% ["praia","cinema","futebol","arte","culinaria","viagem","livros","fitness","outros"].each do |hobby| %>
              <label class="hobby-item">
                <%= check_box_tag "user[hobbies_list][]", hobby, @user.hobbies_list.include?(hobby) %>
                <span><%= hobby.capitalize %></span>
              </label>
            <% end %>
          </div>
        </div>

      </div> <!-- /profile-grid -->


      <%= f.submit "Salvar Alterações", class: "profile-submit" %>
      <%= link_to "Editar Senha", edit_user_registration_path,
          class: "bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded" %>

    <% end %>

  </div> <!-- /profile-card -->
  
<div class="photo-album-grid">
      <% @user.album_photos.each do |photo| %>
        <div class="album-photo-item">
          <%= image_tag photo, class: "album-photo-image" %>

          <%# O link de exclusão usa o Turbo/Rails para enviar um DELETE separado %>
          <%= link_to "X", delete_album_photo_path(photo),
              data: { turbo_method: :delete, turbo_confirm: "Tem certeza que deseja excluir esta foto?" },
              class: "delete-photo-button" %>
        </div>
      <% end %>
    </div>
  </div>

</div>

<script>
function previewImage(event) {
  const reader = new FileReader();
  reader.onload = function() {
    document.getElementById("avatar-preview").src = reader.result;
  };
  reader.readAsDataURL(event.target.files[0]);
}
</script>
