<div class="chat-container">

  <div class="chat-header">
    <img src="<%= @match.other_user(current_user).avatar_url || '/assets/avatarfoto.jpg' %>"
         class="avatar" style="width:42px;height:42px;border-radius:50%;">

    <div class="title">
      <%= @match.other_user(current_user).display_name %>
      <div class="status">
        <% if @match.other_user(current_user).online? %>
          ğŸŸ¢ Online
        <% else %>
          âšª Offline
        <% end %>
      </div>
    </div>
  </div>

  <div id="chat-window"
       class="chat-window"
       data-match-id="<%= @match.id %>"
       data-current-user-id="<%= current_user.id %>">

    <% @messages.each do |message| %>
      <div id="msg-<%= message.id %>"
           data-sending="false"
           data-content="<%= message.content %>"
           class="message <%= message.sender_id == current_user.id ? 'sent' : 'received' %>">

        <div class="message-inner">
          <% unless message.sender_id == current_user.id %>
            <img src="<%= message.sender.avatar_url || '/assets/avatarfoto.jpg' %>" class="avatar">
          <% end %>

          <div class="bubble">
            <div class="meta">
              <% unless message.sender_id == current_user.id %>
                <strong class="name"><%= message.sender.display_name %></strong>
              <% end %>

              <small class="time"><%= message.created_at.strftime("%H:%M") %></small>
            </div>

            <p class="content"><%= message.content %></p>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div id="typing-indicator" class="typing-indicator"></div>

  <div class="chat-input">
    <%= form_with url: match_messages_path(@match),
                  method: :post,
                  id: "new-message-form",
                  data: { remote: true } do |form| %>

      <%= form.text_field :content, id: "message-input",
            placeholder: "Digite sua mensagem...", autocomplete: "off" %>

      <%= form.submit "Enviar", id: "send-button" %>

    <% end %>
  </div>

</div>

<%= javascript_import_module_tag "chat_logic" %>
